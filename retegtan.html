<!DOCTYPE html>
<html>
<head>
  <title>Földtani Metszetek Játéka</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin-top: 20px;
    }

    .samples-container {
      display: flex;
      gap: 40px;
      justify-content: center;
      margin: 20px;
    }

    .sample {
      width: 180px;
      background-color: #fff;
      border: 2px solid #bbb;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .sample h2 {
      margin: 10px 0;
      font-size: 1.1rem;
      text-align: center;
    }

    .layer {
      position: relative;
      width: 100%;
      height: 40px;
      margin: 5px 0;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      border-top: 2px solid #333;
    }

    /* Ősmaradvány-jelek */
    .fossil {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin: 2px;
    }

    .trilobite {
      background-color: #3f51b5; /* Trilobita (Indigó) */
    }
    .coral {
      background-color: #e91e63; /* Korall (Rózsaszín) */
    }
    .shark {
      background-color: #00bcd4; /* Cápa (Cián) */
    }
    .lizard {
      background-color: #ffeb3b; /* Gyík (Sárga) */
    }

    /* Jelkulcs panel */
    #legend {
      background-color: #fff;
      border: 2px solid #bbb;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
      margin: 20px;
      padding: 10px;
      width: 220px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      margin: 5px 0;
      font-size: 0.95rem;
    }

    .legend-item .fossil {
      margin-right: 8px;
    }

    /* Játék vezérlők */
    #game {
      background-color: #fff;
      border: 2px solid #bbb;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
      padding: 20px;
      margin: 20px;
      text-align: center;
      width: 300px;
    }

    #order-inputs {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
      margin: 10px 0;
    }

    select {
      margin-left: 5px;
    }

    #big-column {
      background-color: #fff;
      border: 2px solid #bbb;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
      margin: 20px;
      padding: 10px;
      width: 180px;
      display: flex;
      flex-direction: column;
      align-items: center;
      /* Csak akkor jelenik meg, ha a felhasználó helyesen tippel */
      display: none;
    }

    #big-column .layer {
      border-top: 2px solid #444;
    }

    #buttons {
      margin-top: 10px;
    }

    #play-again {
      margin-left: 10px;
      padding: 6px 12px;
      background-color: #2196f3;
      color: #fff;
      border: none;
      cursor: pointer;
    }

    #play-again:hover {
      background-color: #1976d2;
    }
  </style>
</head>
<body>

  <h1>Földtani Metszetek Játéka</h1>

  <!-- Jelkulcs -->
  <div id="legend">
    <h2>Ősmaradvány Jelkulcs</h2>
    <div class="legend-item">
      <div class="fossil trilobite"></div>
      <span>Trilobita</span>
    </div>
    <div class="legend-item">
      <div class="fossil coral"></div>
      <span>Korall</span>
    </div>
    <div class="legend-item">
      <div class="fossil shark"></div>
      <span>Cápa</span>
    </div>
    <div class="legend-item">
      <div class="fossil lizard"></div>
      <span>Gyík</span>
    </div>
  </div>

  <!-- A véletlenszerűen létrehozott minták tárolója -->
  <div class="samples-container" id="samples-container"></div>

  <!-- Játék: Találd el a minták sorrendjét (legidősebbtől a legfiatalabbig) -->
  <div id="game">
    <h2>Találd el a minták sorrendjét (legidősebbtől a legfiatalabbig)!</h2>
    <div id="order-inputs">
      <div>
        <label for="pos1">Legidősebb minta:</label>
        <select id="pos1">
          <option value="">Válassz</option>
          <option value="Voros Ridge">Vörös-gerinc</option>
          <option value="Oak Valley">Tölgy-völgy</option>
          <option value="Lake District">Tóvidék</option>
        </select>
      </div>
      <div>
        <label for="pos2">Középső minta:</label>
        <select id="pos2">
          <option value="">Válassz</option>
          <option value="Voros Ridge">Vörös-gerinc</option>
          <option value="Oak Valley">Tölgy-völgy</option>
          <option value="Lake District">Tóvidék</option>
        </select>
      </div>
      <div>
        <label for="pos3">Legfiatalabb minta:</label>
        <select id="pos3">
          <option value="">Válassz</option>
          <option value="Voros Ridge">Vörös-gerinc</option>
          <option value="Oak Valley">Tölgy-völgy</option>
          <option value="Lake District">Tóvidék</option>
        </select>
      </div>
    </div>

    <div id="buttons">
      <button id="check-order">Ellenőrzés</button>
      <button id="play-again">Újra játszom</button>
    </div>

    <p id="order-result"></p>
  </div>

  <!-- A teljes földtani oszlop 8 réteggel (0 = legidősebb, 7 = legfiatalabb) -->
  <div id="big-column">
    <h2>Teljes földtani oszlop</h2>
    <div id="big-column-inner"></div>
  </div>

  <script>
    //////////////////////////////////////////////
    // Segédfüggvények és véletlenszerűsítés
    //////////////////////////////////////////////

    const FOSSIL_TYPES = ["trilobite", "coral", "shark", "lizard"];
    const COLOR_PALETTE = [
      "#9c27b0", // lila
      "#ff9800", // narancs
      "#2196f3", // kék
      "#4caf50", // zöld
      "#fce5cd", // világosnarancs
      "#ffccf9", // rózsaszínes
      "#cfd8dc", // szürkéskék
      "#cddc39"  // lime
    ];

    // Fisher-Yates keverés
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function getRandomFossils() {
      // 2..4 ősmaradvány véletlenszerűen
      const count = Math.floor(Math.random() * 3) + 2;
      const fossils = [];
      for (let i = 0; i < count; i++) {
        const randIndex = Math.floor(Math.random() * FOSSIL_TYPES.length);
        fossils.push(FOSSIL_TYPES[randIndex]);
      }
      return fossils;
    }

    // Intervallek (bottom, top) részleges átfedés ellenőrzése
    function strictlyPartialOverlap(r1, r2) {
      // Legyen átfedés
      const doOverlap = (r1.bottom <= r2.top) && (r2.bottom <= r1.top);
      // Viszont egyik se tartalmazza teljesen a másikat
      const r1ContainsR2 = (r1.bottom <= r2.bottom && r2.top <= r1.top);
      const r2ContainsR1 = (r2.bottom <= r1.bottom && r1.top <= r2.top);
      return doOverlap && !r1ContainsR2 && !r2ContainsR1;
    }

    function rangeMidpoint(r) {
      return (r.bottom + r.top) / 2;
    }

    //////////////////////////////////////////////
    // 8 réteg létrehozása
    //////////////////////////////////////////////

    let allStrata = [];

    function generateAllStrata() {
      // 8 réteg 0..7
      // Az egyes rétegek színeit és ősmaradványait véletlenszerűen állítjuk be
      const colorOrder = shuffle([...COLOR_PALETTE]);
      const strata = [];
      for (let i = 0; i < 8; i++) {
        strata.push({
          index: i,
          fossils: getRandomFossils(),
          color: colorOrder[i]
        });
      }
      return strata;
    }

    //////////////////////////////////////////////
    // 3 véletlen intervallum részleges átfedéssel
    //////////////////////////////////////////////

    function randomRange() {
      // bottom: 0..5, top: bottom+1..7
      const b = Math.floor(Math.random() * 6);
      const t = Math.floor(Math.random() * (7 - (b + 1) + 1)) + (b + 1);
      return { bottom: b, top: t };
    }

    function distinctPartialOverlap(ranges) {
      // 1) Nincs két azonos bottom-top
      // 2) Nincs két megegyező középpont (midpoint)
      // 3) Minden pár strictlyPartialOverlap

      const setOfBottomTops = new Set();
      const setOfMids = new Set();

      for (let i = 0; i < ranges.length; i++) {
        const r = ranges[i];
        const key = `${r.bottom}-${r.top}`;
        const mid = rangeMidpoint(r);

        if (setOfBottomTops.has(key) || setOfMids.has(mid)) {
          return false;
        }
        setOfBottomTops.add(key);
        setOfMids.add(mid);
      }

      for (let i = 0; i < ranges.length; i++) {
        for (let j = i + 1; j < ranges.length; j++) {
          if (!strictlyPartialOverlap(ranges[i], ranges[j])) {
            return false;
          }
        }
      }

      return true;
    }

    function getThreeRangesWithPartialOverlap() {
      while (true) {
        const candidate = [randomRange(), randomRange(), randomRange()];
        if (distinctPartialOverlap(candidate)) {
          return candidate;
        }
      }
    }

    //////////////////////////////////////////////
    // A három minta neve
    //////////////////////////////////////////////
    // 0 => Vörös-gerinc, 1 => Tölgy-völgy, 2 => Tóvidék

    const SAMPLE_NAMES = [
      "Voros Ridge",       // belső logika
      "Oak Valley",     // belső logika
      "Lake District"   // belső logika
    ];

    //////////////////////////////////////////////
    // Minták létrehozása + sorrend
    //////////////////////////////////////////////

    let finalSamples = [];
    let correctOrder = [];

    function createStrictPartialOverlapSamples() {
      const ranges = getThreeRangesWithPartialOverlap();
      const samples = [];
      for (let i = 0; i < 3; i++) {
        const r = ranges[i];
        const midpoint = rangeMidpoint(r);
        samples.push({
          name: SAMPLE_NAMES[i],
          bottom: r.bottom,
          top: r.top,
          midpoint: midpoint
        });
      }
      return samples;
    }

    function buildSampleHTML(s) {
      // s = { name, bottom, top, midpoint }
      let html = `<div class=\"sample\" id=\"sample${s.name}\">`;
      // Felirat a kód szerint, belső logika
      // A felületet magyarul is megjelenítjük

      // Mivel a "Voros Ridge" => "Vörös-gerinc" a felhasználói selectben,
      // de belső name marad, most is a s.name-t használjuk. A megjelenítés magyarításhoz lefordítjuk.
      let displayName = '';
      if (s.name === 'Voros Ridge') {
        displayName = 'Vörös-gerinc';
      } else if (s.name === 'Oak Valley') {
        displayName = 'Tölgy-völgy';
      } else {
        displayName = 'Tóvidék';
      }

      html += `<h2>${displayName}</h2>`;
      for (let i = s.top; i >= s.bottom; i--) {
        const stratum = allStrata[i];
        html += `<div class=\"layer\" style=\"background-color:${stratum.color}\">`;
        stratum.fossils.forEach(f => {
          html += `<div class=\"fossil ${f}\"></div>`;
        });
        html += `</div>`;
      }
      html += `</div>`;
      return html;
    }

    function renderSamples() {
      const container = document.getElementById('samples-container');
      container.innerHTML = '';
      let html = '';
      finalSamples.forEach(s => {
        html += buildSampleHTML(s);
      });
      container.innerHTML = html;
    }

    function computeCorrectOrder() {
      // Rendezzük a finalSamples tömböt midpoint alapján (növekvő) => legidősebb->legfiatalabb
      const sorted = [...finalSamples].sort((a,b) => a.midpoint - b.midpoint);
      return sorted.map(s => s.name);
    }

    //////////////////////////////////////////////
    // A teljes földtani oszlop megjelenítése
    //////////////////////////////////////////////

    function renderBigColumn() {
      const bigColInner = document.getElementById('big-column-inner');
      let bigHTML = '';
      for (let i = allStrata.length - 1; i >= 0; i--) {
        const s = allStrata[i];
        bigHTML += `<div class=\"layer\" style=\"background-color:${s.color}\">`;
        s.fossils.forEach(f => {
          bigHTML += `<div class=\"fossil ${f}\"></div>`;
        });
        bigHTML += `</div>`;
      }
      bigColInner.innerHTML = bigHTML;
    }

    function initGame() {
      allStrata = generateAllStrata();
      finalSamples = createStrictPartialOverlapSamples();
      renderSamples();
      correctOrder = computeCorrectOrder();

      document.getElementById('big-column').style.display = 'none';
      document.getElementById('big-column-inner').innerHTML = '';

      document.getElementById('pos1').value = '';
      document.getElementById('pos2').value = '';
      document.getElementById('pos3').value = '';

      document.getElementById('order-result').textContent = '';
    }

    document.getElementById('check-order').addEventListener('click', () => {
      const pos1 = document.getElementById('pos1').value;
      const pos2 = document.getElementById('pos2').value;
      const pos3 = document.getElementById('pos3').value;

      if (!pos1 || !pos2 || !pos3) {
        document.getElementById('order-result').textContent = 'Kérjük, válassz mintát mindhárom pozícióhoz!';
        return;
      }

      const userOrder = [pos1, pos2, pos3];
      if (JSON.stringify(userOrder) === JSON.stringify(correctOrder)) {
        document.getElementById('order-result').textContent = 'Helyes! Remek munka! Íme a teljes oszlop:';
        renderBigColumn();
        document.getElementById('big-column').style.display = 'block';
      } else {
        document.getElementById('order-result').textContent = 'Helytelen. Próbáld újra!';
      }
    });

    document.getElementById('play-again').addEventListener('click', () => {
      initGame();
    });

    initGame();
  </script>
</body>
</html>
