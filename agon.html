<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Agon - Nagyított Verzió</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --p1-color: #1a1a1a;
            --p2-color: #ffffff;
            --accent: #3498db;
        }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            background-color: var(--bg-color); 
            margin: 0; 
            padding: 20px;
            overflow-x: hidden;
        }
        
        #status { 
            margin-bottom: 20px; 
            font-size: 1.6em; 
            font-weight: 800; 
            background: white; 
            padding: 15px 40px; 
            border-radius: 100px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-placing { color: #fff; background: #e74c3c !important; animation: pulse-red 1.5s infinite; }
        @keyframes pulse-red { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        #game-container { 
            background: #fff; 
            padding: 20px; 
            border-radius: 30px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
            width: 90vw;
            max-width: 800px;
            display: flex;
            justify-content: center;
        }

        svg { 
            width: 100%; 
            height: auto; 
            max-height: 80vh;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.1));
        }
        
        /* Mezők */
        .hex { stroke: #333; stroke-width: 0.5; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
        .hex:hover { filter: brightness(1.1); }
        
        .ring-6 { fill: #cfd8dc; } .ring-5 { fill: #b0bec5; } .ring-4 { fill: #90a4ae; }
        .ring-3 { fill: #78909c; } .ring-2 { fill: #607d8b; } .ring-1 { fill: #546e7a; }
        .throne { fill: #ffc107; stroke: #ff6f00; stroke-width: 3; }

        /* Kijelölések */
        .selectable { stroke: #2ecc71; stroke-width: 5; stroke-linejoin: round; }
        .target { stroke: #f39c12; stroke-width: 6; stroke-dasharray: 8; animation: dash 1s linear infinite; }
        .placement-zone { fill: var(--accent) !important; stroke: #fff; stroke-width: 4; }

        @keyframes dash { to { stroke-dashoffset: -16; } }

        /* Bábuk - pointer-events: none kritikus a kattintáshoz! */
        .piece-ui { pointer-events: none; }
        .p1 { fill: var(--p1-color); stroke: #000; stroke-width: 1; }
        .p2 { fill: var(--p2-color); stroke: #333; stroke-width: 2; }
        .crown { fill: #f39c12; }

        .log-container { 
            margin-top: 20px; background: #2c3e50; padding: 15px; border-radius: 15px; 
            width: 90vw; max-width: 800px; color: #ecf0f1;
            height: 120px; overflow-y: auto; font-family: monospace;
        }
        .log-msg { margin: 4px 0; border-left: 3px solid #3498db; padding-left: 10px; opacity: 0.9; }
        .log-alert { border-left-color: #e74c3c; color: #ff7675; font-weight: bold; }
    </style>
</head>
<body>

    <div id="status">Sötét következik</div>
    
    <div id="game-container">
        <svg id="board" viewBox="0 0 1000 1000"></svg>
    </div>

    <div class="log-container" id="log">
        <div class="log-msg">Játék indítva. Jó szórakozást!</div>
    </div>

<script>
    const svg = document.getElementById('board');
    const statusDiv = document.getElementById('status');
    const logContainer = document.getElementById('log');
    
    // MÉRETEK NÖVELÉSE
    const R = 48; // Mező sugara (35-ről 48-ra növelve)
    const W = Math.sqrt(3) * R;
    const H = 2 * R;
    const CENTER = 500; // SVG viewBox középpontja
    
    let turn = 1; 
    let selectedHex = null;
    let gameState = {}; 
    let capturedPool = { 1: [], 2: [] }; 

    function addLog(msg, isAlert = false) {
        const div = document.createElement('div');
        div.className = isAlert ? 'log-msg log-alert' : 'log-msg';
        div.innerText = `[${new Date().toLocaleTimeString('hu-HU')}] ${msg}`;
        logContainer.prepend(div);
    }

    function getRing(q, r) { 
        return Math.max(Math.abs(q), Math.abs(r), Math.abs(-q-r)); 
    }

    function createBoard() {
        svg.innerHTML = ''; // Alaphelyzet
        for (let q = -6; q <= 6; q++) {
            for (let r = Math.max(-6, -q - 6); r <= Math.min(6, -q + 6); r++) {
                const x = CENTER + W * (q + r/2);
                const y = CENTER + (H * 3/4) * r;
                const ring = getRing(q, r);
                
                const hex = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
                const points = [];
                for (let i = 0; i < 6; i++) {
                    const angle = (i * 60 - 30) * Math.PI / 180;
                    points.push(`${x + R * Math.cos(angle)},${y + R * Math.sin(angle)}`);
                }
                
                hex.setAttribute("points", points.join(" "));
                hex.setAttribute("class", `hex ring-${ring} ${ring === 0 ? 'throne' : ''}`);
                hex.setAttribute("id", `hex-${q},${r}`);
                // Fontos: a mezőre tesszük az eseménykezelőt
                hex.onclick = (e) => { e.preventDefault(); handleHexClick(q, r); };
                svg.appendChild(hex);
            }
        }
        setupInitialPosition();
        updateUI();
    }

    function setupInitialPosition() {
        gameState["0,-6"] = {p: 1, t: 'q'};
        [[-2,-4], [-4,-2], [-6,0], [2,-6], [4,-6], [6,-6]].forEach(pos => gameState[pos.join(',')] = {p:1, t:'g'});
        
        gameState["0,6"] = {p: 2, t: 'q'};
        [[-2,6], [-4,6], [-6,6], [2,4], [4,2], [6,0]].forEach(pos => gameState[pos.join(',')] = {p:2, t:'g'});
    }

    function updateUI() {
        document.querySelectorAll('.piece-ui').forEach(p => p.remove());
        document.querySelectorAll('.hex').forEach(h => h.classList.remove('selectable', 'target', 'placement-zone'));

        // Bábuk rajzolása
        for (const [id, piece] of Object.entries(gameState)) {
            const [q, r] = id.split(',').map(Number);
            const x = CENTER + W * (q + r/2);
            const y = CENTER + (H * 3/4) * r;
            
            const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
            g.setAttribute("class", "piece-ui");
            
            const c = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            c.setAttribute("cx", x); c.setAttribute("cy", y);
            c.setAttribute("r", piece.t === 'q' ? R*0.75 : R*0.55);
            c.setAttribute("class", `p${piece.p}`);
            g.appendChild(c);

            if(piece.t === 'q') {
                const crown = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                crown.setAttribute("cx", x); crown.setAttribute("cy", y); 
                crown.setAttribute("r", R*0.3);
                crown.setAttribute("class", "crown"); 
                g.appendChild(crown);
            }
            svg.appendChild(g);
        }

        if (capturedPool[turn].length > 0) {
            const pToPlace = capturedPool[turn][0];
            statusDiv.innerText = `VISSZAHELYEZÉS: ${pToPlace.t === 'q' ? 'Királynő' : 'Őr'}`;
            statusDiv.className = "status-placing";
            showPlacementOptions(pToPlace);
        } else {
            statusDiv.innerText = `${turn === 1 ? 'Sötét' : 'Világos'} következik`;
            statusDiv.className = "";
            for (const id in gameState) {
                if (gameState[id].p === turn) {
                    const el = document.getElementById(`hex-${id}`);
                    if(el) el.classList.add('selectable');
                }
            }
        }
    }

    function showPlacementOptions(piece) {
        document.querySelectorAll('.hex').forEach(hex => {
            const id = hex.id.replace('hex-','');
            const [q, r] = id.split(',').map(Number);
            if (!gameState[id] && getRing(q, r) !== 0) {
                if (piece.t === 'q' || getRing(q, r) === 6) {
                    hex.classList.add('placement-zone');
                }
            }
        });
    }

    function handleHexClick(q, r) {
        const id = `${q},${r}`;
        const hexEl = document.getElementById(`hex-${id}`);

        if (capturedPool[turn].length > 0) {
            if (hexEl && hexEl.classList.contains('placement-zone')) {
                gameState[id] = capturedPool[turn].shift();
                addLog(`${turn === 1 ? 'Sötét' : 'Világos'} visszatette bábuját.`);
                endTurn();
            }
            return;
        }

        if (selectedHex) {
            if (isValidMove(selectedHex.q, selectedHex.r, q, r)) {
                executeMove(selectedHex.q, selectedHex.r, q, r);
            } else {
                if (gameState[id] && gameState[id].p === turn) {
                    selectedHex = {q, r};
                    highlightPossibleMoves(q, r);
                } else {
                    selectedHex = null;
                    updateUI();
                }
            }
        } else {
            if (gameState[id] && gameState[id].p === turn) {
                selectedHex = {q, r};
                highlightPossibleMoves(q, r);
            }
        }
    }

    function highlightPossibleMoves(q, r) {
        document.querySelectorAll('.hex').forEach(h => h.classList.remove('target'));
        const dirs = [[1,0], [-1,0], [0,1], [0,-1], [-1,1], [1,-1]];
        dirs.forEach(d => {
            if (isValidMove(q, r, q+d[0], r+d[1])) {
                const el = document.getElementById(`hex-${q+d[0]},${r+d[1]}`);
                if (el) el.classList.add('target');
            }
        });
    }

    function isValidMove(q1, r1, q2, r2) {
        const targetId = `${q2},${r2}`;
        if (gameState[targetId]) return false;
        if (!document.getElementById(`hex-${targetId}`)) return false;

        const ring1 = getRing(q1, r1), ring2 = getRing(q2, r2);
        // Hex távolság számítása
        const dist = Math.max(Math.abs(q1-q2), Math.abs(r1-r2), Math.abs((-q1-r1)-(-q2-r2)));
        
        if (dist !== 1) return false;
        if (ring2 === 0 && gameState[`${q1},${r1}`].t !== 'q') return false;
        
        return ring2 <= ring1; // Csak befelé vagy azonos gyűrűn
    }

    function executeMove(q1, r1, q2, r2) {
        const piece = gameState[`${q1},${r1}`];
        delete gameState[`${q1},${r1}`];
        gameState[`${q2},${r2}`] = piece;
        
        addLog(`${turn === 1 ? 'Sötét' : 'Világos'} lépett.`);
        checkCaptures(q2, r2);
        endTurn();
    }

    function checkCaptures(q, r) {
        const p = gameState[`${q},${r}`].p;
        const dirs = [[1,0], [-1,0], [0,1], [0,-1], [-1,1], [1,-1]];
        
        dirs.forEach(d => {
            const eq = q+d[0], er = r+d[1];
            const enemy = gameState[`${eq},${er}`];
            if (enemy && enemy.p !== p) {
                const fq = eq+d[0], fr = er+d[1];
                const friend = gameState[`${fq},${fr}`];
                if (friend && friend.p === p) {
                    const victim = gameState[`${eq},${er}`];
                    // Ütés!
                    delete gameState[`${eq},${er}`];
                    capturedPool[victim.p].push(victim);
                    capturedPool[victim.p].sort((a,b) => a.t === 'q' ? -1 : 1);
                    addLog(`ÜTÉS! ${victim.p === 1 ? 'Sötét' : 'Világos'} bábu fogságba esett!`, true);
                }
            }
        });
    }

    function endTurn() {
        selectedHex = null;
        turn = turn === 1 ? 2 : 1;
        updateUI();
        setTimeout(checkWinCondition, 100);
    }

    function checkWinCondition() {
        const t = gameState["0,0"];
        if (t && t.t === 'q') {
            const p = t.p;
            const neighbors = [[1,0], [-1,0], [0,1], [0,-1], [-1,1], [1,-1]];
            const guardCount = neighbors.filter(d => {
                const piece = gameState[`${d[0]},${d[1]}`];
                return piece && piece.p === p && piece.t === 'g';
            }).length;

            if (guardCount === 6) {
                alert(`VÉGE A JÁTÉKNAK! A ${p === 1 ? 'Sötét' : 'Világos'} játékos győzött!`);
                location.reload();
            }
        }
    }

    createBoard();
</script>
</body>
</html>
